–Æ<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä</title>
    <style>
        body {
            text-align: center;
            background-color: #111;
            color: white;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
            margin: 20px auto;
            background: black;
            border-radius: 10px;
        }
        .controls {
            margin-top: 10px;
        }
        input, select {
            margin: 5px;
            padding: 8px;
        }
    </style>
</head>
<body>

    <h1>–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä</h1>

    <button onclick="startVisualization()">üé§ –í–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω</button>

    <br>

    <canvas id="visualizer"></canvas>

    <div class="controls">
        <label>–¶–≤–µ—Ç: <input type="color" id="colorPicker" value="#00ffcc"></label>
        <label>–†–∞–∑–º–µ—Ä: <input type="range" id="sizeRange" min="10" max="100" value="50"></label>
        <label>–§–æ—Ä–º–∞:
            <select id="shapeSelect">
                <option value="bars">–ü–æ–ª–æ—Å—ã</option>
                <option value="circles">–ö—Ä—É–≥–∏</option>
            </select>
        </label>
    </div>

    <script>
        let audioContext, analyser, dataArray, canvas, ctx;
        let color = "#00ffcc";
        let shape = "bars";
        let sizeMultiplier = 50;

        function startVisualization() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = audioContext.createAnalyser();
                    let source = audioContext.createMediaStreamSource(stream);
                    source.connect(analyser);
                    analyser.fftSize = 256;
                    let bufferLength = analyser.frequencyBinCount;
                    dataArray = new Uint8Array(bufferLength);

                    canvas = document.getElementById("visualizer");
                    ctx = canvas.getContext("2d");
                    canvas.width = window.innerWidth * 0.8;
                    canvas.height = 300;

                    visualize();
                })
                .catch(err => {
                    alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É: " + err);
                });
        }

        function visualize() {
            requestAnimationFrame(visualize);
            analyser.getByteFrequencyData(dataArray);

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#000";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = color;

            let barWidth = (canvas.width / dataArray.length) * 2.5;
            let radius = sizeMultiplier;

            if (shape === "bars") {
                for (let i = 0; i < dataArray.length; i++) {
                    let barHeight = dataArray[i] * (sizeMultiplier / 50);
                    let x = i * barWidth;
                    ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
                }
            } else if (shape === "circles") {
                let centerX = canvas.width / 2;
                let centerY = canvas.height / 2;
                let maxRadius = Math.max(...dataArray) * (sizeMultiplier / 100);
                ctx.beginPath();
                ctx.arc(centerX, centerY, maxRadius, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        document.getElementById("colorPicker").addEventListener("input", (e) => {
            color = e.target.value;
        });

        document.getElementById("sizeRange").addEventListener("input", (e) => {
            sizeMultiplier = e.target.value;
        });

        document.getElementById("shapeSelect").addEventListener("change", (e) => {
            shape = e.target.value;
        });
    </script>

</body>
</html>