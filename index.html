<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Авторизация ВКонтакте</title>
</head>
<body>
    <h1>Авторизация ВКонтакте и загрузка видео</h1>

    <!-- Поле для ввода ID группы -->
    <div>
        <label for="groupIdInput">Введите ID группы:</label>
        <input type="text" id="groupIdInput" placeholder="Пример: 123456789">
        <button onclick="saveGroupId()">Сохранить ID группы</button>
    </div>
    
    <!-- Поле для отображения статуса -->
    <div id="status" style="margin-top: 20px; color: red;"></div>
    
    <!-- Подключение VKID SDK -->
    <div>
        <script src="https://unpkg.com/@vkid/sdk@<3.0.0/dist-sdk/umd/index.js"></script>
        <script type="text/javascript">
            if ('VKIDSDK' in window) {
                const VKID = window.VKIDSDK;
                let groupId = ''; // ID группы будет сохранен здесь

                // Инициализация VKID SDK
                VKID.Config.init({
                    app: 52966542, // ID вашего приложения
                    redirectUrl: 'https://fhyh246.github.io/anegdot/', // URL редиректа
                    responseMode: VKID.ConfigResponseMode.Callback,
                    source: VKID.ConfigSource.LOWCODE,
                    scope: 'video,groups,offline', // Запрашиваемые права
                });

                // Создание кнопки авторизации One Tap
                const oneTap = new VKID.OneTap();

                oneTap.render({
                    container: document.currentScript.parentElement,
                    showAlternativeLogin: true
                })
                .on(VKID.WidgetEvents.ERROR, vkidOnError)
                .on(VKID.OneTapInternalEvents.LOGIN_SUCCESS, function (payload) {
                    const code = payload.code;
                    const deviceId = payload.device_id;

                    // Обмен кода на токен доступа
                    VKID.Auth.exchangeCode(code, deviceId)
                        .then(vkidOnSuccess)
                        .catch(vkidOnError);
                });

                // Обработка успешной авторизации
                function vkidOnSuccess(data) {
                    console.log("Успешная авторизация:", data);
                    const token = data.access_token;
                    document.getElementById('status').innerText = "Авторизация прошла успешно! Токен: " + token;

                    // Использование токена для дальнейших операций
                    startVideoUpload(token);
                }

                // Обработка ошибок авторизации
                function vkidOnError(error) {
                    console.error("Ошибка авторизации:", error);
                    document.getElementById('status').innerText = "Ошибка авторизации. Проверьте настройки.";
                }

                // Функция для сохранения ID группы
                function saveGroupId() {
                    const input = document.getElementById('groupIdInput').value.trim();
                    if (input) {
                        groupId = input;
                        document.getElementById('status').innerText = "ID группы сохранен: " + groupId;
                    } else {
                        document.getElementById('status').innerText = "Введите корректный ID группы.";
                    }
                }

                // Заглушка для функции загрузки видео
                function startVideoUpload(token) {
                    if (!groupId) {
                        document.getElementById('status').innerText = "Введите ID группы перед загрузкой видео.";
                        return;
                    }
                    
                    console.log("Готов к загрузке видео в группу ID:", groupId, "с токеном:", token);
                    // Здесь можно добавить логику для загрузки видео в группу
                }
            }
        </script>
    </div>
</body>
</html>