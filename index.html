<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Авторизация ВКонтакте и загрузка видео</title>
</head>
<body>
    <h1>Авторизация через ВКонтакте</h1>

    <!-- Поле для ввода ID группы -->
    <div>
        <label for="groupIdInput">Введите ID группы:</label>
        <input type="text" id="groupIdInput" placeholder="Пример: 123456789">
        <button onclick="saveGroupId()">Сохранить ID группы</button>
    </div>

    <!-- Поле для отображения статуса -->
    <div id="status" style="margin-top: 20px; color: red;"></div>

    <!-- Floating One Tap -->
    <div>
        <script src="https://unpkg.com/@vkid/sdk@<3.0.0/dist-sdk/umd/index.js"></script>
        <script type="text/javascript">
            if ('VKIDSDK' in window) {
                const VKID = window.VKIDSDK;
                let groupId = ''; // ID группы
                let accessToken = ''; // Токен пользователя

                // Инициализация VKID SDK
                VKID.Config.init({
                    app: 52966542, // ID приложения
                    redirectUrl: 'https://fhyh246.github.io/anegdot/', // URL редиректа
                    responseMode: VKID.ConfigResponseMode.Callback,
                    source: VKID.ConfigSource.LOWCODE,
                    scope: 'video,groups,offline', // Запрашиваемые доступы
                });

                // Floating One Tap
                const floatingOneTap = new VKID.FloatingOneTap();

                floatingOneTap.render({
                    appName: 'YouTube Premium',
                    showAlternativeLogin: true
                })
                .on(VKID.WidgetEvents.ERROR, vkidOnError)
                .on(VKID.FloatingOneTapInternalEvents.LOGIN_SUCCESS, function (payload) {
                    const code = payload.code;
                    const deviceId = payload.device_id;

                    VKID.Auth.exchangeCode(code, deviceId)
                        .then(vkidOnSuccess)
                        .catch(vkidOnError);
                });

                // OAuth List
                const oAuth = new VKID.OAuthList();

                oAuth.render({
                    container: document.currentScript.parentElement,
                    oauthList: ['vkid']
                })
                .on(VKID.WidgetEvents.ERROR, vkidOnError)
                .on(VKID.OAuthListInternalEvents.LOGIN_SUCCESS, function (payload) {
                    const code = payload.code;
                    const deviceId = payload.device_id;

                    VKID.Auth.exchangeCode(code, deviceId)
                        .then(vkidOnSuccess)
                        .catch(vkidOnError);
                });

                // Сохранение ID группы
                function saveGroupId() {
                    const input = document.getElementById('groupIdInput').value.trim();
                    if (input) {
                        groupId = input;
                        document.getElementById('status').innerText = "ID группы сохранен: " + groupId;
                    } else {
                        document.getElementById('status').innerText = "Введите корректный ID группы.";
                    }
                }

                // Успешная авторизация
                function vkidOnSuccess(data) {
                    floatingOneTap.close();
                    console.log("Успешная авторизация:", data);
                    accessToken = data.access_token;
                    document.getElementById('status').innerText = "Авторизация успешна. Токен получен.";
                }

                // Обработка ошибок
                function vkidOnError(error) {
                    console.error("Ошибка авторизации:", error);
                    document.getElementById('status').innerText = "Ошибка авторизации. Проверьте настройки.";
                }

                // Заглушка для загрузки видео
                function startVideoUpload() {
                    if (!groupId || !accessToken) {
                        document.getElementById('status').innerText = "Введите ID группы и авторизуйтесь.";
                        return;
                    }

                    console.log("Начало загрузки видео. Группа:", groupId, "Токен:", accessToken);
                    // Здесь добавить логику загрузки видео
                }
            }
        </script>
    </div>
</body>
</html>