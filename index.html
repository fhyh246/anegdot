<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Автозагрузка видео в ВКонтакте</title>
</head>
<body>
    <h1>Автозагрузка популярных видео с YouTube в ВКонтакте</h1>
    <label for="groupId">ID группы ВКонтакте:</label>
    <input type="text" id="groupId" placeholder="Введите ID группы">
    <button id="startUpload">Начать загрузку</button>
    <div id="status"></div>

    <script>
        const youtubeApiKey = "AIzaSyAP6_WnY1mY2f-Wu-bmXucBt3ZKd15xUbE"; // Ключ API YouTube
        const vkServiceToken = "ecc5b84cecc5b84cecc5b84cc0efed8c2ceecc5ecc5b84c8b511ddeeea5a3e19c4dd83b"; // Ваш токен ВКонтакте

        document.getElementById('startUpload').addEventListener('click', async () => {
            const groupId = document.getElementById('groupId').value.trim();
            const status = document.getElementById('status');

            if (!groupId) {
                status.textContent = "Пожалуйста, укажите ID группы.";
                return;
            }

            try {
                // 1. Получаем список популярных русскоязычных видео с YouTube
                const youtubeResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&regionCode=RU&maxResults=10&key=${youtubeApiKey}`);
                const youtubeData = await youtubeResponse.json();

                if (youtubeData.error) {
                    throw new Error(`Ошибка API YouTube: ${youtubeData.error.message}`);
                }

                const videos = youtubeData.items;

                // 2. Обрабатываем видео одно за другим
                for (const video of videos) {
                    const youtubeLink = `https://www.youtube.com/watch?v=${video.id}`;
                    const videoTitle = video.snippet.title;

                    status.textContent = `Загружаю видео: ${videoTitle}`;

                    // 3. Запрашиваем сервер загрузки видео в ВКонтакте
                    const vkResponse = await fetch(`https://api.vk.com/method/video.save?group_id=${groupId}&link=${encodeURIComponent(youtubeLink)}&access_token=${vkServiceToken}&v=5.131`);
                    const vkData = await vkResponse.json();

                    if (vkData.error) {
                        throw new Error(`Ошибка API ВКонтакте: ${vkData.error.error_msg}`);
                    }

                    const uploadUrl = vkData.response.upload_url;

                    // 4. Загружаем видео
                    await fetch(uploadUrl, { method: 'POST' });

                    status.textContent = `Видео "${videoTitle}" успешно загружено в группу!`;
                }

                status.textContent = "Все видео успешно загружены!";
            } catch (error) {
                console.error(error);
                status.textContent = `Произошла ошибка: ${error.message}`;
            }
        });
    </script>
</body>
</html>