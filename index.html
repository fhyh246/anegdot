<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Random YouTube Video to VK</title>
  <script>
    const vkAccessToken = "vk1.a.ZozFqNJORej3Db-7By7jcfHZi-yJfY_tDViMKaS_6yEadeb3RwW2bQnlsw8j57zs54JIECcdUQZAROcmEzSh-52Hb9QS3WJ-O0flvspESlsZnb37Ye7UZgYqtQaVHTyVdbrGk3gjeztLpAtcHKtz7s_lczG6tQnWnnebPpGeYl6vPrisKawdiaAhcgZte24DV_a-M7yyq7l-OBLQXCuWWw"; // VK Token
    const groupId = 229141221; // VK Group ID
    const youtubeApiKey = "AIzaSyAP6_WnY1mY2f-Wu-bmXucBt3ZKd15xUbE"; // YouTube API ключ

    async function fetchRandomYouTubeVideo() {
      console.log("Запрос случайного видео с YouTube...");

      // Поиск случайного видео через YouTube API
      const query = "random";
      const maxResults = 1;

      try {
        const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${query}&type=video&maxResults=${maxResults}&key=${youtubeApiKey}`);
        const data = await response.json();

        if (data.error) {
          console.error("Ошибка YouTube API:", data.error.message);
          return null;
        }

        const videoId = data.items[0]?.id?.videoId;
        const videoTitle = data.items[0]?.snippet?.title;
        const videoUrl = `https://www.youtube.com/watch?v=${videoId}`;

        console.log("Случайное видео:", videoTitle, videoUrl);
        return videoUrl;
      } catch (error) {
        console.error("Ошибка при запросе YouTube API:", error);
        return null;
      }
    }

    async function uploadVideoToVK(videoUrl) {
      if (!videoUrl) {
        console.error("Видео URL не найден!");
        return;
      }

      console.log("Запрос подготовки загрузки в VK...");
      try {
        const response = await fetch(`https://api.vk.com/method/video.save?group_id=${groupId}&link=${encodeURIComponent(videoUrl)}&v=5.131&access_token=${vkAccessToken}`, {
          method: "GET"
        });
        const data = await response.json();

        if (data.error) {
          console.error("Ошибка VK API:", data.error.error_msg);
          return;
        }

        console.log("Видео сохранено в VK:", data.response);
        const uploadUrl = data.response.upload_url;

        console.log("Загрузка видео в VK...");
        const uploadResponse = await fetch(uploadUrl, { method: "POST" });
        const uploadData = await uploadResponse.json();

        if (uploadData.error) {
          console.error("Ошибка при загрузке видео в VK:", uploadData.error);
          return;
        }

        console.log("Видео успешно опубликовано в группе VK!");
        alert("Видео успешно опубликовано!");
      } catch (error) {
        console.error("Ошибка загрузки в VK:", error);
      }
    }

    async function handleRandomVideoUpload() {
      console.log("Начало процесса загрузки случайного видео...");
      const videoUrl = await fetchRandomYouTubeVideo();
      if (videoUrl) {
        await uploadVideoToVK(videoUrl);
      }
    }
  </script>
</head>
<body>
  <h1>Загрузка случайного видео с YouTube в VK</h1>
  <button onclick="handleRandomVideoUpload()">Загрузить случайное видео</button>
</body>
</html>