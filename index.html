<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Загрузка видео в ВК</title>
</head>
<body>
    <h1>Загрузка видео в группу ВК</h1>

    <label for="group-id">Введите ID группы:</label>
    <input type="text" id="group-id" placeholder="ID вашей группы">
    <br><br>

    <button id="auth-btn">Авторизоваться через VK ID</button>
    <p id="auth-status">Статус: Не авторизован</p>

    <hr>

    <button id="youtube-btn">Загрузить случайное видео с YouTube</button>
    <button id="upload-btn">Загрузить собственный файл</button>

    <input type="file" id="file-input" style="display: none;">

    <p id="console">Консоль:</p>

    <script>
        const YOUTUBE_API_KEY = "AIzaSyAP6_WnY1mY2f-Wu-bmXucBt3ZKd15xUbE";
        let VK_ACCESS_TOKEN = "vk1.a.gHSaXmdTg09tetrGXSU2Y0vh5LL0m4RIAeCZqypgp_bNkLydy850nopp02JNjjsXuy2B4jKynySRb1klvy-5xsxFfzAqa9CfvG7EjRZEQnDAdm_dBpA0px4Uycg4v1G5KRsjLSOV_rkQ81dysO_j7i6ze_zSstaGAJWceun7_IO4OJwjryZVlHDg3M1WLuI33FrYwEtV47emz7oHxgjjCQ";
        let groupId;

        function logToConsole(message) {
            const consoleElement = document.getElementById('console');
            consoleElement.innerHTML += `<br>${message}`;
        }

        // Авторизация через VK ID
        document.getElementById('auth-btn').addEventListener('click', function () {
            logToConsole("Запуск авторизации...");
            // Здесь можно добавить VK ID SDK для получения токена
            logToConsole("Авторизация успешна. Токен уже установлен.");
        });

        // Получение ID группы
        document.getElementById('group-id').addEventListener('change', function (e) {
            groupId = e.target.value;
            logToConsole(`ID группы установлен: ${groupId}`);
        });

        // Загрузка случайного видео с YouTube
        document.getElementById('youtube-btn').addEventListener('click', async function () {
            if (!groupId) {
                logToConsole("Ошибка: Укажите ID группы.");
                return;
            }

            logToConsole("Запрос случайного видео с YouTube...");
            try {
                const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=1&type=video&videoEmbeddable=true&videoCaption=any&key=${YOUTUBE_API_KEY}&relevanceLanguage=ru`);
                const data = await response.json();
                if (data.items && data.items.length > 0) {
                    const videoId = data.items[0].id.videoId;
                    const videoTitle = data.items[0].snippet.title;
                    logToConsole(`Видео для загрузки: ${videoTitle} (${videoId})`);

                    logToConsole("Запрос ссылки для загрузки видео в ВК...");
                    const vkResponse = await fetch(`https://api.vk.com/method/video.save?group_id=${groupId}&name=${encodeURIComponent(videoTitle)}&description=${encodeURIComponent(videoTitle)}&v=5.131&access_token=${VK_ACCESS_TOKEN}`);
                    const vkData = await vkResponse.json();

                    if (vkData.response) {
                        const uploadUrl = vkData.response.upload_url;
                        logToConsole(`Ссылка для загрузки получена. Загрузка видео...`);
                        await fetch(uploadUrl, {
                            method: 'POST',
                        });
                        logToConsole("Видео успешно загружено в группу.");
                    } else {
                        throw new Error(vkData.error.error_msg || "Неизвестная ошибка");
                    }
                } else {
                    throw new Error("Видео не найдено.");
                }
            } catch (error) {
                logToConsole(`Ошибка при загрузке видео: ${error.message}`);
            }
        });

        // Загрузка собственного файла
        document.getElementById('upload-btn').addEventListener('click', function () {
            if (!groupId) {
                logToConsole("Ошибка: Укажите ID группы.");
                return;
            }

            document.getElementById('file-input').click();
        });

        document.getElementById('file-input').addEventListener('change', async function (e) {
            const file = e.target.files[0];
            if (!file) {
                logToConsole("Ошибка: Файл не выбран.");
                return;
            }

            logToConsole(`Загрузка файла: ${file.name}`);
            try {
                const vkResponse = await fetch(`https://api.vk.com/method/photos.getUploadServer?group_id=${groupId}&v=5.131&access_token=${VK_ACCESS_TOKEN}`);
                const vkData = await vkResponse.json();

                if (vkData.response && vkData.response.upload_url) {
                    const uploadUrl = vkData.response.upload_url;
                    const formData = new FormData();
                    formData.append('file1', file);

                    const uploadResponse = await fetch(uploadUrl, {
                        method: 'POST',
                        body: formData,
                    });
                    const uploadData = await uploadResponse.json();

                    logToConsole("Файл успешно загружен.");
                } else {
                    throw new Error(vkData.error.error_msg || "Неизвестная ошибка");
                }
            } catch (error) {
                logToConsole(`Ошибка при загрузке файла: ${error.message}`);
            }
        });
    </script>
</body>
</html>