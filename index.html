<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Случайные видео из YouTube в плейлист VK</title>
  <script>
    const vkToken = "vk1.a.ZozFqNJORej3Db-7By7jcfHZi-yJfY_tDViMKaS_6yEadeb3RwW2bQnlsw8j57zs54JIECcdUQZAROcmEzSh-52Hb9QS3WJ-O0flvspESlsZnb37Ye7UZgYqtQaVHTyVdbrGk3gjeztLpAtcHKtz7s_lczG6tQnWnnebPpGeYl6vPrisKawdiaAhcgZte24DV_a-M7yyq7l-OBLQXCuWWw";
    const groupId = 229141221;
    const ytApiKey = "AIzaSyAP6_WnY1mY2f-Wu-bmXucBt3ZKd15xUbE";
    const playlistId = "1024403723_1"; // ID вашего плейлиста

    // Функция для получения случайного видео с YouTube
    async function getRandomYouTubeVideo() {
      console.log("Запрос случайного видео с YouTube...");
      try {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=50&type=video&key=${ytApiKey}`);
        const data = await res.json();
        if (data.error) throw new Error(data.error.message);

        // Выбираем случайное видео
        const randomVideo = data.items[Math.floor(Math.random() * data.items.length)];
        console.log("Случайное видео:", randomVideo);
        return randomVideo;
      } catch (err) {
        console.error("Ошибка YouTube API:", err);
        return null;
      }
    }

    // Функция для добавления видео в плейлист VK
    async function addVideoToPlaylist(videoUrl) {
      console.log("Добавление видео в плейлист VK...");
      try {
        const res = await fetch(`https://api.vk.com/method.video.save?group_id=${groupId}&link=${encodeURIComponent(videoUrl)}&v=5.131&access_token=${vkToken}`);
        const data = await res.json();
        if (data.error) throw new Error(data.error.error_msg);

        console.log("Видео успешно добавлено в группу");

        // Добавление видео в плейлист
        const videoId = data.response.video_id;
        const addToPlaylistRes = await fetch(`https://api.vk.com/method/video.add?video_id=${videoId}&playlist_id=${playlistId}&v=5.131&access_token=${vkToken}`);
        const addToPlaylistData = await addToPlaylistRes.json();

        if (addToPlaylistData.error) throw new Error(addToPlaylistData.error.error_msg);
        
        console.log("Видео успешно добавлено в плейлист!");
      } catch (err) {
        console.error("Ошибка при добавлении в плейлист:", err);
      }
    }

    // Функция для запуска процесса
    async function handleUpload() {
      console.clear();
      console.log("Начало процесса...");
      const randomVideo = await getRandomYouTubeVideo();
      if (randomVideo) {
        const videoUrl = `https://www.youtube.com/watch?v=${randomVideo.id.videoId}`;
        await addVideoToPlaylist(videoUrl);
      }
    }
  </script>
</head>
<body>
  <h1>Добавить случайное видео из YouTube в плейлист VK</h1>
  <button onclick="handleUpload()">Добавить случайное видео в плейлист VK</button>
</body>
</html>