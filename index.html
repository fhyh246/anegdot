ДБ<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube to VK</title>
</head>
<body>
    <h1>Загрузка видео с YouTube в группу ВКонтакте</h1>
    <button id="start">Начать загрузку</button>
    <button id="stop">Остановить загрузку</button>
    <p id="status">Статус: Ожидание</p>

    <script>
        const YOUTUBE_API_KEY = "AIzaSyAP6_WnY1mY2f-Wu-bmXucBt3ZKd15xUbE"; // Ваш API-ключ YouTube
        const VK_ACCESS_TOKEN = "vk1.a.gHSaXmdTg09tetrGXSU2Y0vh5LL0m4RIAeCZqypgp_bNkLydy850nopp02JNjjsXuy2B4jKynySRb1klvy-5xsxFfzAqa9CfvG7EjRZEQnDAdm_dBpA0px4Uycg4v1G5KRsjLSOV_rkQ81dysO_j7i6ze_zSstaGAJWceun7_IO4OJwjryZVlHDg3M1WLuI33FrYwEtV47emz7oHxgjjCQ"; // Ваш пользовательский токен ВКонтакте
        const GROUP_ID = "229141221"; // ID группы ВКонтакте, в которую загружаются видео

        let isRunning = false;

        document.getElementById("start").addEventListener("click", async () => {
            if (isRunning) return;
            isRunning = true;
            document.getElementById("status").innerText = "Статус: Загрузка началась";

            try {
                const videos = await getYouTubeVideos();
                for (const video of videos) {
                    if (!isRunning) break;

                    document.getElementById("status").innerText = `Загружается: ${video.title}`;
                    await uploadVideoToVK(video);
                }

                document.getElementById("status").innerText = "Статус: Загрузка завершена";
            } catch (error) {
                console.error("Ошибка:", error);
                document.getElementById("status").innerText = "Статус: Ошибка при загрузке";
            }
        });

        document.getElementById("stop").addEventListener("click", () => {
            isRunning = false;
            document.getElementById("status").innerText = "Статус: Загрузка остановлена";
        });

        // Получение популярных видео YouTube
        async function getYouTubeVideos() {
            const response = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&regionCode=RU&videoCategoryId=0&maxResults=10&key=${YOUTUBE_API_KEY}`);
            const data = await response.json();

            if (!response.ok || data.error) {
                throw new Error(`Ошибка API YouTube: ${data.error.message}`);
            }

            return data.items.map(item => ({
                id: item.id,
                title: item.snippet.title,
                description: item.snippet.description
            }));
        }

        // Загрузка видео в ВКонтакте
        async function uploadVideoToVK(video) {
            // 1. Получить сервер для загрузки
            const saveResponse = await fetch(`https://api.vk.com/method/video.save?name=${encodeURIComponent(video.title)}&description=${encodeURIComponent(video.description)}&group_id=${GROUP_ID}&access_token=${VK_ACCESS_TOKEN}&v=5.131`);
            const saveData = await saveResponse.json();

            if (!saveResponse.ok || saveData.error) {
                throw new Error(`Ошибка API VK (video.save): ${saveData.error.error_msg}`);
            }

            const uploadUrl = saveData.response.upload_url;

            // 2. Загрузить видео
            const uploadResponse = await fetch(uploadUrl, {
                method: "POST",
                body: new FormData()
            });

            const uploadData = await uploadResponse.json();
            if (!uploadResponse.ok || uploadData.error) {
                throw new Error(`Ошибка загрузки видео на сервер VK: ${uploadData.error}`);
            }

            console.log(`Видео "${video.title}" успешно загружено в группу ВКонтакте!`);
        }
    </script>
</body>
</html>