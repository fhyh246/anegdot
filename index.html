<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор ссылок</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .working {
            color: green;
        }
        .not-working {
            color: red;
        }
        #results {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>Генератор и проверка ссылок</h1>
    <button id="start">Начать генерацию</button>
    <button id="stop" disabled>Остановить</button>
    <div id="results"></div>

    <script>
        const baseURL = "https://kra26.at/storage/image";
        let isRunning = false;
        const parallelRequests = 50; // Количество одновременных запросов

        // Функция для генерации случайной строки
        function generateRandomString(length) {
            const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
            let result = "";
            for (let i = 0; i < length; i++) {
                result += chars[Math.floor(Math.random() * chars.length)];
            }
            return result;
        }

        // Функция для генерации ссылки
        function generateURL() {
            const firstPart = generateRandomString(2);
            const secondPart = generateRandomString(2);
            const fileName = generateRandomString(16);
            const uuid = `${generateRandomString(8)}-${generateRandomString(4)}-${generateRandomString(4)}-${generateRandomString(4)}-${generateRandomString(12)}`;
            return `${baseURL}/${firstPart}/${secondPart}/${fileName}.webp/${uuid}/`;
        }

        // Функция для проверки доступности ссылки
        async function checkURL(url) {
            try {
                const response = await fetch(url, { method: "HEAD" });
                if (response.ok) {
                    return { url, status: "working" };
                } else {
                    return { url, status: "not-working" };
                }
            } catch (error) {
                return { url, status: "not-working" };
            }
        }

        // Функция для запуска процесса генерации и проверки
        async function startGeneration() {
            const resultsDiv = document.getElementById("results");
            isRunning = true;
            document.getElementById("start").disabled = true;
            document.getElementById("stop").disabled = false;

            while (isRunning) {
                const tasks = [];
                for (let i = 0; i < parallelRequests; i++) {
                    const url = generateURL();
                    tasks.push(checkURL(url));
                }

                const results = await Promise.all(tasks);

                results.forEach(result => {
                    const resultElement = document.createElement("div");
                    resultElement.textContent = result.url;
                    resultElement.className = result.status === "working" ? "working" : "not-working";
                    resultsDiv.appendChild(resultElement);
                });

                // Ограничиваем рост количества элементов
                if (resultsDiv.childNodes.length > 500) {
                    while (resultsDiv.childNodes.length > 500) {
                        resultsDiv.removeChild(resultsDiv.firstChild);
                    }
                }

                // Прокрутка вниз, чтобы видеть новые результаты
                resultsDiv.scrollTop = resultsDiv.scrollHeight;
            }
        }

        // Остановка генерации
        function stopGeneration() {
            isRunning = false;
            document.getElementById("start").disabled = false;
            document.getElementById("stop").disabled = true;
        }

        // Привязка кнопок
        document.getElementById("start").addEventListener("click", startGeneration);
        document.getElementById("stop").addEventListener("click", stopGeneration);
    </script>
</body>
</html>