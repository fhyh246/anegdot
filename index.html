<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Авторизация ВКонтакте и загрузка видео</title>
</head>
<body>
    <h1>Авторизация через ВКонтакте и загрузка видео</h1>

    <!-- Поле для ввода ID группы -->
    <div>
        <label for="groupIdInput">Введите ID группы:</label>
        <input type="text" id="groupIdInput" placeholder="Пример: 123456789">
        <button onclick="saveGroupId()">Сохранить ID группы</button>
    </div>

    <!-- Кнопка авторизации -->
    <div style="margin-top: 20px;">
        <button id="authButton" onclick="startAuth()">Авторизоваться через ВКонтакте</button>
    </div>

    <!-- Кнопка для загрузки видео -->
    <div style="margin-top: 20px;">
        <button id="uploadButton" onclick="uploadVideo()" disabled>Загрузить видео</button>
    </div>

    <!-- Поле для отображения статуса -->
    <div id="status" style="margin-top: 20px; color: red;"></div>

    <!-- Консоль для логирования -->
    <div style="margin-top: 20px; padding: 10px; background: #f4f4f4; border: 1px solid #ddd;">
        <h3>Консоль:</h3>
        <pre id="consoleLog" style="max-height: 200px; overflow-y: auto; background: #000; color: #0f0; padding: 10px;"></pre>
    </div>

    <script>
        let groupId = ''; // ID группы
        let accessToken = ''; // Токен пользователя

        // Функция для вывода в консоль
        function logToConsole(message) {
            const consoleElement = document.getElementById('consoleLog');
            consoleElement.innerText += message + "\n";
            consoleElement.scrollTop = consoleElement.scrollHeight; // Прокрутка вниз
        }

        // Сохранение ID группы
        function saveGroupId() {
            const input = document.getElementById('groupIdInput').value.trim();
            if (input) {
                groupId = input;
                document.getElementById('status').innerText = "ID группы сохранен: " + groupId;
                logToConsole("ID группы сохранен: " + groupId);
            } else {
                document.getElementById('status').innerText = "Введите корректный ID группы.";
                logToConsole("Ошибка: введен некорректный ID группы.");
            }
        }

        // Запуск авторизации
        function startAuth() {
            logToConsole("Запуск авторизации...");

            // Здесь должен быть вызов авторизации (например, через VKID SDK или OAuth)
            // В примере предполагается, что токен уже будет получен после успешной авторизации.
            accessToken = "ВАШ_ТОКЕН"; // Здесь подставьте реальный токен после авторизации
            document.getElementById('status').innerText = "Авторизация успешна. Токен получен.";
            logToConsole("Авторизация успешна. Токен получен.");
            document.getElementById('uploadButton').disabled = false; // Разблокировать кнопку загрузки видео
        }

        // Функция загрузки видео
        async function uploadVideo() {
            logToConsole("Начало загрузки видео...");
            if (!groupId || !accessToken) {
                document.getElementById('status').innerText = "Введите ID группы и авторизуйтесь.";
                logToConsole("Ошибка: не указан ID группы или токен не получен.");
                return;
            }

            try {
                // Запрашиваем популярные видео на YouTube
                logToConsole("Запрос популярных видео с YouTube...");
                const youtubeResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&chart=mostPopular&regionCode=RU&videoCategoryId=0&type=video&key=AIzaSyAP6_WnY1mY2f-Wu-bmXucBt3ZKd15xUbE`);
                const youtubeData = await youtubeResponse.json();

                if (!youtubeData.items || youtubeData.items.length === 0) {
                    throw new Error("Не удалось получить популярные видео с YouTube.");
                }

                const firstVideo = youtubeData.items[0]; // Берем первое видео
                const videoTitle = firstVideo.snippet.title;
                const videoDescription = firstVideo.snippet.description;
                const videoUrl = `https://www.youtube.com/watch?v=${firstVideo.id.videoId}`;

                logToConsole(`Видео для загрузки: ${videoTitle}`);

                // Получаем ссылку для загрузки видео в ВК
                logToConsole("Запрос ссылки для загрузки видео в ВК...");
                const saveResponse = await fetch(`https://api.vk.com/method/video.save?group_id=${groupId}&name=${encodeURIComponent(videoTitle)}&description=${encodeURIComponent(videoDescription)}&v=5.131&access_token=${accessToken}`);
                const saveData = await saveResponse.json();

                if (saveData.error) {
                    throw new Error("Ошибка VK API: " + saveData.error.error_msg);
                }

                const uploadUrl = saveData.response.upload_url;
                logToConsole("Ссылка для загрузки получена: " + uploadUrl);

                // Загрузка видео на сервер ВКонтакте
                logToConsole("Начало загрузки видео на сервер ВКонтакте...");
                const videoData = new FormData();
                videoData.append("video_file", new Blob(["Ваш видео-файл"])); // Здесь нужно использовать реальный файл

                const uploadResponse = await fetch(uploadUrl, {
                    method: "POST",
                    body: videoData,
                });

                if (!uploadResponse.ok) {
                    throw new Error("Ошибка загрузки видео.");
                }

                logToConsole("Видео успешно загружено.");
                document.getElementById('status').innerText = "Видео успешно загружено в группу!";
            } catch (error) {
                console.error("Ошибка при загрузке видео:", error);
                document.getElementById('status').innerText = "Ошибка при загрузке видео: " + error.message;
                logToConsole("Ошибка при загрузке видео: " + error.message);
            }
        }
    </script>
</body>
</html>