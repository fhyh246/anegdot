<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Сканер QR-Кодов</title>
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 20px;
    }
    #scanner-container {
      width: 100%;
      height: 300px;
      margin-bottom: 20px;
    }
    #results {
      margin-top: 20px;
    }
    table {
      width: 80%;
      margin: 20px auto;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid #000;
    }
    th, td {
      padding: 10px;
      text-align: left;
    }
  </style>
</head>
<body>

  <h1>Сканер QR-Кодов для Товаров</h1>
  
  <!-- Контейнер для сканера -->
  <div id="scanner-container"></div>
  
  <h2>Добавить товар</h2>
  <label for="productGroup">Группа:</label>
  <select id="productGroup">
    <option value="нал">Нал</option>
    <option value="безнал">Безнал</option>
  </select><br><br>

  <label for="productName">Название товара:</label>
  <input type="text" id="productName" placeholder="Введите название товара"><br><br>

  <label for="productQuantity">Количество:</label>
  <input type="number" id="productQuantity" placeholder="Введите количество"><br><br>

  <label for="productPrice">Цена:</label>
  <input type="number" id="productPrice" placeholder="Введите цену"><br><br>

  <button onclick="addProduct()">Добавить товар</button>

  <!-- Таблица с товарами -->
  <h2>Список товаров</h2>
  <table id="productsTable">
    <thead>
      <tr>
        <th>Группа</th>
        <th>Название</th>
        <th>Количество</th>
        <th>Цена</th>
      </tr>
    </thead>
    <tbody>
      <!-- Данные товаров будут отображаться здесь -->
    </tbody>
  </table>

  <script>
    // Инициализация сканера QR-кодов
    const scannerContainer = document.getElementById("scanner-container");
    const html5QrCode = new Html5Qrcode("scanner-container");

    // Функция обработки успешного сканирования QR-кода
    function onScanSuccess(decodedText, decodedResult) {
      // Для примера предполагаем, что QR-код содержит данные в формате:
      // { "name": "Товар", "quantity": 10, "price": 1000 }
      const productData = JSON.parse(decodedText);
      
      // Заполняем форму на основе данных из QR-кода
      document.getElementById("productName").value = productData.name;
      document.getElementById("productQuantity").value = productData.quantity;
      document.getElementById("productPrice").value = productData.price;
      
      // Останавливаем сканирование после успешного сканирования
      html5QrCode.stop().then((ignore) => {
        console.log("QR Code Scanning stopped.");
      }).catch((err) => {
        console.log("Error stopping the QR scanner.", err);
      });
    }

    // Функция начала сканирования
    function startScanner() {
      html5QrCode.start({ facingMode: "environment" }, {
        fps: 10,
        qrbox: 250
      }, onScanSuccess)
      .catch((err) => {
        console.log("Ошибка сканирования:", err);
      });
    }

    // Функция добавления товара в таблицу
    function addProduct() {
      const name = document.getElementById("productName").value;
      const quantity = document.getElementById("productQuantity").value;
      const price = document.getElementById("productPrice").value;
      const group = document.getElementById("productGroup").value;

      if (name && quantity && price) {
        const table = document.getElementById("productsTable").getElementsByTagName("tbody")[0];
        const row = table.insertRow();

        row.insertCell(0).textContent = group;
        row.insertCell(1).textContent = name;
        row.insertCell(2).textContent = quantity;
        row.insertCell(3).textContent = price;

        // Очистка формы после добавления
        document.getElementById("productName").value = '';
        document.getElementById("productQuantity").value = '';
        document.getElementById("productPrice").value = '';
      } else {
        alert("Пожалуйста, заполните все поля.");
      }
    }

    // Запуск сканера при загрузке страницы
    window.onload = startScanner;
  </script>

</body>
</html>
